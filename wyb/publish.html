<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>发表</title>
    <link rel="stylesheet" href="css/publish.css">
    <link rel="stylesheet" href="css/iconfont.css">
    <script type="text/javascript" src="zepto.min.js"></script>
    <!-- <script type="text/javascript" src="js/publish.js"></script> -->
</head>
<body>
    <!-- 最大盒子 -->
    <div class="F_main">
        <!-- 发表文章头部 -->
        <div class="F_article F_color">
            <span class="F_publish_article F_font">发表文章</span>
            <!-- 发表文章的 发布 按钮 -->
            <button id="btn1" class="F_publish_issue F_font F_color">发布</button>
        </div>
        <!-- 添加标题 -->
        <div class="bt_d">
            <textarea class="F_font bt" placeholder="标题"></textarea>
        </div>
        <!-- 发表文章内容输入 -->
        <div class="F_text">
            <textarea class="F_text_textarea F_font" id="text" placeholder="每一个字都值得尊敬..."></textarea>
        </div>
        <!-- 添加图片 -->
        <div class="fb-tp">
            <span class="F_font F_color_p pb-td">点我添加</span>
            <form class="fb-from" name="form0" id="form0">
                <input type="file" class="fb-ib" name="file0" id="file0" multiple="multiple" /><br>  
                <div class="d_img-d">
                    <img class="f_img-j" src="imgs/F-bg.jpg" id="img0">
                </div>
            </form>  
        </div>

        <script>
            $("#file0").change(function(){  
                //获取图片信息
                objUrl = getObjectURL(this.files[0]);
                //判断 给图片加上src
                // console.log(objUrl);
                if (objUrl) {  
                    $("#img0").attr("src", objUrl);  
                }   
                var tpdd = objUrl;
                $('#btn1').click(function(){
                    console.log(tpdd);
                    var a = $('.bt');
                    console.log(a.val());
                    var b = $('#text');
                    console.log(b.val());
                    if (a.val() != "") {
                        if (b.val() != "") {
                            var sj = {
                                bt : a.val(),
                                nr : b.val(),
                            }
                            $.ajax({
                                url : "articleServlet",
                                type : "POST",
                                data : {
                                       "bt":$('.bt').val(),
                                       "nr":$('#text').val(),
                                    //    "tp":tpdd,
                                       "op":"doadd"
                                },
                                dataType : "json",
                                success:function (res) {
                                    a.val('');
                                    b.val('');
                                    if (res[0] == '1') {
        
                                        location.href='dengluhou.html';
                                    } else {
                                        console.log('error');
                                    }
                                }
                            });
                        } else {
                            console.log('内容不得为空');
                        }
                    } else {
                        console.log('标题不得为空');
                    }
                });
            });  


            function getObjectURL(file) {  
                var url = null;  
                if (window.createObjectURL!=undefined) {  
                    url = window.createObjectURL(file) ;  
                } else if (window.URL!=undefined) { // mozilla(firefox)  
                        url = window.URL.createObjectURL(file) ;  
                } else if (window.webkitURL!=undefined) { // webkit or chrome  
                        url = window.webkitURL.createObjectURL(file) ;  
                }  
                return url;  
            }  
        </script>

        <!-- 所在位置 -->
        <div class="F_location">
            <i class="iconfont icon-map F_color_p F_font_icon F_location_icon"></i>
            <span class="F_location_span">所在位置</span>
        </div>

        <!-- 关联某某某 -->
        <div class="F_location">
            <i class="iconfont icon-aite F_color_z F_font_icon F_location_icon"></i>
            <span class="F_location_span">关联那个她(他)</span>
        </div>
    </div>
    <!-- 底部公共样式 -->
    <div class="F_nav F_font">
        <div class="F_nav_page shouye">
            <div><i class="iconfont icon-caidanshouye F_font_icon"></i></div>
            <div><a href="">首页</a></div>
        </div>
        <div class="F_nav_page xiangfa">
            <div><i class="iconfont icon-skullbulbidea F_font_icon"></i></div>
            <div><a href="">想法</a></div>
        </div>
        <div class="F_nav_page wenzhang">
            <div><i class="iconfont icon-wenzhang F_font_icon"></i></div>
            <div><a href="">文章</a></div>
        </div>
        <div class="F_nav_page tongzhi">
            <div><i class="iconfont icon-tongzhi F_font_icon"></i></div>
            <div><a href="">通知</a></div>
        </div>
        <div class="F_nav_page denglu">
            <div><i class="iconfont icon-guanbi F_font_icon"></i></div>
            <div><a href="">我的</a></div>
        </div>
    </div>
</body>
<script src="http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js"></script>
<script type="text/javascript" src="js/tiaozhuan.js"></script>
</html>